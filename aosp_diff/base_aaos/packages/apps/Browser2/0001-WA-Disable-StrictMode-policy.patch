From 40b58f11012feafa4f436166fe01fb2571875b63 Mon Sep 17 00:00:00 2001
From: "Alam, SahibeX" <sahibex.alam@intel.com>
Date: Mon, 26 Feb 2024 04:08:28 +0000
Subject: [PATCH] WA- Disable StrictMode policy

Tracked-On: OAM-114158
Signed-off-by: Salini Venate <salini.venate@intel.com>
---
 src/org/chromium/webview_shell/WebViewBrowserActivity.java | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/src/org/chromium/webview_shell/WebViewBrowserActivity.java b/src/org/chromium/webview_shell/WebViewBrowserActivity.java
index 0a7b637..4ac1cd6 100644
--- a/src/org/chromium/webview_shell/WebViewBrowserActivity.java
+++ b/src/org/chromium/webview_shell/WebViewBrowserActivity.java
@@ -290,6 +290,7 @@ public class WebViewBrowserActivity extends Activity implements PopupMenu.OnMenu
     @Override
     public void onSaveInstanceState(Bundle savedInstanceState) {
         // Deliberately don't catch TransactionTooLargeException here.
+	final StrictMode.VmPolicy oldPolicy = StrictMode.allowVmViolations();
         mWebView.saveState(savedInstanceState);
 
         // TODO(timav): Remove this hack after http://crbug.com/626202 is fixed.
@@ -297,11 +298,13 @@ public class WebViewBrowserActivity extends Activity implements PopupMenu.OnMenu
         // can't handle large states without a crash.
         byte[] webViewState = savedInstanceState.getByteArray(SAVE_RESTORE_STATE_KEY);
         if (webViewState != null && webViewState.length > MAX_STATE_LENGTH) {
+	    Log.e(TAG, "Drop saved instance: ");
             savedInstanceState.remove(SAVE_RESTORE_STATE_KEY);
             String message = String.format(
                     Locale.US, "Can't save state: %dkb is too long", webViewState.length / 1024);
             Toast.makeText(this, message, Toast.LENGTH_SHORT).show();
         }
+	StrictMode.setVmPolicy(oldPolicy);
     }
 
     @Override
-- 
2.17.1

